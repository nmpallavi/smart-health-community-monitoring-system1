<!DOCTYPE html>
<html>
<head>
    <title>Worker Dashboard</title>
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/storage.js"></script>
    <script src="../js/seed.js"></script>
</head>
<body>

<div class="header"><h2>Health Worker Dashboard</h2></div>

<div class="container">
    <div class="card">

        <div style="display:flex;justify-content:space-between;align-items:center;">
            <strong id="workerName"></strong>
            <button class="btn" onclick="logout()">Logout</button>
        </div>

        <hr>

        <h3>Your Area Water Sources</h3>
        <div id="waterList"></div>

        <hr>

        <h3>Quick Actions</h3>
        <button class="btn" onclick="goToWater()">Check Water Quality</button>
        <button class="btn" onclick="goToReports()">View Villager Reports</button>
        <a href="worker_alerts.html"><button class="btn">Alerts</button></a>
    </div>
</div>

<script>
// Protect Page
(function protect() {
    const active = JSON.parse(localStorage.getItem("activeWorker") || "null");
    if (!active) {
        alert("Please login as worker.");
        window.location.href = "worker_login.html";
    } else {
        document.getElementById("workerName").innerText =
            active.name + " â€” " + active.area;

        loadWaterSources();
    }
})();

// Load water sources from worker's area
function loadWaterSources() {
    const active = JSON.parse(localStorage.getItem("activeWorker"));
    const sources = getData("water_sources");

    const mySources = sources.filter(
        s => s.area.toLowerCase() === active.area.toLowerCase()
    );

    const cont = document.getElementById("waterList");
    cont.innerHTML = "";

    if (mySources.length === 0) {
        cont.innerHTML = "<p>No water sources added for your area.</p>";
        return;
    }

    mySources.forEach(src => {
        const box = document.createElement("div");
        box.style.border = "1px solid #ccc";
        box.style.padding = "10px";
        box.style.borderRadius = "8px";
        box.style.marginBottom = "8px";

        box.innerHTML = `
            <strong>${src.name}</strong><br>
            Quality: <b>${src.quality}</b><br>
            Last Checked: ${src.last_checked}<br>
        `;

        cont.appendChild(box);
    });
}

function goToWater() {
    window.location.href = "worker_water_check.html";
}
function goToReports() {
    window.location.href = "worker_reports.html";
}
function logout() {
    localStorage.removeItem("activeWorker");
    window.location.href = "../index.html";
}
</script>

</body>
</html>
